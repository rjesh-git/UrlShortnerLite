function shortenURL(e, t, n, r, ty) {
    if (ty == 1) shortendurl(e, t, n, r);
    else if (ty == 2) shortenlurl(e, t, n, r);
}
function shortendurl(e, t, n, r) {
    ctx = new SP.ClientContext.get_current;
    var i = new SP.AppContextSite(ctx, n);
    var s = i.get_web();
    ctx.load(s);
    var o = s.get_lists().getById(t);
    listItem = o.getItemById(e);
    ctx.load(listItem, "FileLeafRef", "FileRef", "EncodedAbsUrl");
    ctx.executeQueryAsync(Function.createDelegate(this, this.shrtdUrlSuccess), Function.createDelegate(this, this.shrtUrlFail))
}
function shortenlurl(e, t, n, r) {
    ctx = new SP.ClientContext.get_current;
    var i = new SP.AppContextSite(ctx, n);
    var s = i.get_web();
    ctx.load(s);
    lst = s.get_lists().getById(t);
    ctx.load(lst);
    ctx.executeQueryAsync(Function.createDelegate(this, this.shrtlUrlSuccess), Function.createDelegate(this, this.shrtUrlFail))
}
function generateShortUrl(e, t, n, r)
{
    $.getJSON("https://api-ssl.bitly.com/v3/shorten?callback=?", { format: "json", apiKey: n, login: t, longUrl: e }, function (e) { r(e.data.url) })
}
function shrtdUrlSuccess(e, t)
{
    var n = listItem.get_item("EncodedAbsUrl");
    generateShortUrl(n, "rjeshllc", "R_4da5bf9ff1a8dc60fb1f7ff77a0c469a",
        function (e){
            var t = $("<p align='left'><img src='" + e + ".qrcode' class='img-responsive' alt='QR Code'/></p>"); $("#contentcolumn").append(t); $("#txtLongUrl").append(n); $("#txtShortUrl").val(e); $("#txtShortUrl").focus().select()
    })
}
function shrtlUrlSuccess(e, t) {
    //var n = lst.get_defaultDisplayFormUrl();
    var n =  SP.List.get_defaultDisplayFormUrl();
    alert(n);
    generateShortUrl(n, "rjeshllc", "R_4da5bf9ff1a8dc60fb1f7ff77a0c469a",
        function (e) {
            var t = $("<p align='left'><img src='" + e + ".qrcode'/></p>"); $("#contentcolumn").append(t); $("#txtLongUrl").append(n); $("#txtShortUrl").val(e); $("#txtShortUrl").focus().select()
        })
}
function shrtUrlFail(e, t) {
    alert("failed to get data. Error:" + t.get_message())
}
function getQueryStringParameter(e) {
    var t = document.URL.split("?")[1].split("&"); var n = "";
    for (var r = 0; r < t.length; r = r + 1) {
        var i = t[r].split("="); if (i[0] == e) return i[1]
    }
}
var ctx; var web; var user; var listItem; var lst;